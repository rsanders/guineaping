<html>
  <head>
        <title>Pingtrox</title>

        <link href="ui/air/base.css" rel="stylesheet" type="text/css"/>
		
        <script type="text/javascript" src="lib/air/AIRAliases.js"></script>
        <script type="text/javascript" src="lib/air/AIRIntrospector.js"></script>
        <script type="text/javascript" src="lib/air/AIRLocalizer.js"></script>
        <script type="text/javascript" src="lib/air/AIRMenuBuilder.js"></script>
        <script type="text/javascript" src="lib/air/AIRSourceViewer.js"></script> 

        <script type="application/x-shockwave-flash" src="lib/air/servicemonitor.swf"></script>
        <script type="application/x-shockwave-flash" src="lib/air/applicationupdater.swf"></script>
        <script type="application/x-shockwave-flash" src="lib/air/applicationupdater_ui.swf"></script> 

		<!-- clean up some platform differences -->
        <script type="text/javascript" src="lib/platform/air.js" charset="utf-8"></script>

		<!-- load the cross-platform generic JS library code -->
        <script type="text/javascript" src="lib/pingboard/jquery.js" charset="utf-8"></script>
        <script type="text/javascript" src="lib/pingboard/xmlutils.js" charset="utf-8"></script>
        <script type="text/javascript" src="lib/pingboard/base64.js" charset="utf-8"></script>
        <script type="text/javascript" src="lib/pingboard/pretty.js" charset="utf-8"></script>
        <script type="text/javascript" src="lib/pingboard/ajaxqueue.js" charset="utf-8"></script>
        <script type="text/javascript" src="lib/dojo/dojo/dojo.js" 
            djConfig="parseOnLoad: true"></script>

		<!-- load cross-platform PingFM library -->
        <script type="text/javascript" src="lib/pingboard/pingfm.js" charset="utf-8"></script>

		<!-- load cross-platform APP code -->
        <script type="text/javascript" src="lib/pingboard/common.js" charset="utf-8"></script>
		
		<!-- load platform-specific APP code -->
        <script type="text/javascript" src="lib/pingboard/air.js" charset="utf-8"></script>

        <script type="text/javascript">
        // AIR-related functions created by the developer
      
	  	air.trace("Requiring dojo...");
	  
        dojo.require("dojo.parser");
        dojo.require("dijit.form.Button");
        dojo.require("dijit.form.Textarea");
        dojo.require("dijit.form.ComboBox"); 
        dojo.require("dijit.form.Form"); 

        dojo.require("dojo.data.ItemFileReadStore");
        </script>
  </head>
		
    <body>
   	<h1>Pingtrox</h1>
	<div id="page_main" class="page">
        <div id="messagediv">
                  <textarea rows="4" cols="50" name="post_text" id="post_text" dojoType="dijit.form.Textarea"></textarea>
        </div>
		<select id="post_type" name="post_type">
		</select>
        <div id="buttondiv" style="float:right;">
                  <input type="submit" id="postbutton" name="postbutton" value="Post" onclick="doPost();"
            />
        </div>
		<div id="svciconbox" style="clear:both;">
		</div>
		<div id="error" style="clear:both;">
		</div>
	</div> <!-- page_main -->

	<div id="page_config" class="page">
		<h3>Config Page</h3>
		<label for="app_key">App Key</label>
		<input type="text" name="app_key" value="" id="app_key" onchange="updateConfig(event);"/>

		<label for="option_shorten">Shorten URLs</label>
		<input type="checkbox" id="option_shorten" name="option_shorten" onchange="updateConfig(event);" />

		<label for="option_debug">Debug</label>
		<input type="checkbox" id="option_debug" name="option_debug" onchange="updateConfig(event);" />
		
	</div> <!-- page_config -->

	<div id="page_history" class="page">
		<h3>History Page</h3>
		
	</div> <!-- page_history -->
 
 	<div id="pagebar" class="pagebar">
 		<input type="button" value="Main" onclick="showPage('page_main');" />
 		<input type="button" value="Config" onclick="showPage('page_config');" />
 		<input type="button" value="History" onclick="showPage('page_history');" />
	</div>
 
	<script type="text/javascript">
		var pages = ["page_main", "page_config", "page_history"];
	
		function includePage(pagename) {
//			jQuery.get('./ui/air/page_' + pagename + '.html', null, function (data) {
//				console.log('includePage: *** got data for page ' + pagename);
//				jQuery('#page_'+pagename).html(data);
//			}, 'html');
			jQuery('#page_'+pagename).load('./ui/air/page_' + pagename + '.html', null, 
				function() {
					dojo.parser.parse(document.getElementById('page_'+pagename));
				});
		}

		function showPage(name) {
			jQuery('.current_page').hide().removeClass('current_page').trigger('hidden');
			jQuery('#' + name).show().addClass('current_page').trigger('shown');
		}
		
		function updateConfig(event) {
			console.log("updateConfig " + event);	
			var name = event.target.name;
			console.log("name = " + name);
		}
		
		jQuery(function() 
			{
				air.trace("Loading...");
				
				// start app
				load();
				
				// includePage('config');
				includePage('history');

				jQuery('.page').hide();
				showPage('page_main');
				
				jQuery('#post_type').change(function(event) { console.log("got a change"); setPostType(event); });
				
				jQuery('#page_config')
					.bind('hidden', function(event) {
							console.log("Saving prefs for hidden config page...");
							configDone(event);
					})
					.bind('shown', function() {
							console.log("Populating prefs for shown config page...");
							populatePrefs();
					});
			});
	</script>
    </body>
</html>